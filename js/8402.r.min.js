/*! DO NOT MODIFY THIS FILE, IT IS COMPILED! */

define("field/Gamefield.Brains",[],function(){var e="Gamefield.Brains";return U.define({className:e,gameNumberCls:"game-number",createNumber:function(){var e={},t=[2,2,2,2,2,2,2,2,4];return e.value=t[this.getRandom(0,t.length-1)],e},$findFreePos:function(e,t){var i=this,n=e.find(U.c2s(t)),s=n.filter(function(){var e=$(this);return!e.find(U.c2s(i.gameNumberCls)).get(0)}),r=this.getRandom(0,s.length-1);return s.eq(r)},findFreePos:function(e){for(var t,i,n=[],s=0,r=e.length;r>s;s++){t=e[s];for(var o=0,l=t.cells.length;l>o;o++)i=t.cells[o],i.value||n.push(i)}if(n.length<0)return!1;var a=this.getRandom(0,n.length-1);return n[a]},getRandom:function(e,t){var i=e+Math.random()*(t+1-e);return 0^i}}),U.ClassManager.get(e).prototype}),define("field/face/face.control.main",[],function(){function e(e){e.$on("someEvent",function(e,t){console.log(t)}),window.gfScope=e}return e}),define("abstract/AbstractAngularComponent",[],function(){"use strict";U.define({className:"AbstractAngularComponent",selectedItemCls:"selected",containerPostFix:"-container",autoRender:!0,renderToParent:!1,renderAppend:!1,bubbleButtonEvent:!0,initComponent:function(e){U.apply(this,e),this.autoRender===!0&&this.render()},redoRender:function(){return this.removeEl(),this.forceRender()},forceRender:function(){return this.rendered=!1,this.rendering=!1,this.render()},render:function(e){e=e||{};var t,i,n,s;if(s=e.forcedRenderType||this.renderType||"append",this.rendered||this.rendering)return!1;if(this.onBeforeRender()===!1)return this;if(this.rendering=!0,this.renderToSelector=U.isDefined(this.renderToId)?"#"+this.renderToId:this.renderToSelector,t=$(this.renderToSelector||this.renderToElement),"innerHTML"===s){if(i=t.get(0))if(n=this.processTpl(),"tbody"===i.tagName.toLowerCase())try{i.innerHTML=i.innerHTML||"",this.renderAppend?i.innerHTML+=n:i.innerHTML=n}catch(r){t[this.renderAppend?"append":"html"](n)}else i.innerHTML=i.innerHTML||"",this.renderAppend?i.innerHTML+=n:i.innerHTML=n;this.$el=this.renderToParent?t:t.children().first()}else{if(this.$el=$(this.processTpl()),!t[s]||!U.isFunction(t[s]))throw"Unknown render type";t[s](this.$el),this.$el=this.renderToParent?t:this.$el}return this._finishRender()},postRender:function(){return this.$el=this.findEl(),this._finishRender()},_finishRender:function(){return this.rendering=!1,this.rendered=!0,this.onRender&&this.onRender(),this.visible="hidden"!==this.$el.css("visibility")&&"none"!==this.$el.css("display"),this},processTpl:function(e,t){return U.processTpl.apply(this,arguments)},setVisible:function(e){if(!this.$el||!this.rendered)return!1;var t="visible"===this.$el.css("visibility")?!0:!1;return(e!==t||this.visible!==t)&&(this.$el.css({visibility:e?"visible":"hidden"}),this.visible=e),!0},setDisplayed:function(e,t){return this.$el&&this.rendered?(this[e?"show":"hide"](t),!0):!1},hide:function(e){e=e||0,0===e?this.$el.hide():this.$el.fadeOut(e),this.visible=!1,this.onHide()},show:function(e){this.onBeforeShow(),e=e||0,0===e?this.$el.show():this.$el.fadeIn(e),this.visible=!0,this.onShow()},onBeforeShow:U.emptyFn,removeEl:function(){return this.renderToParent?(this.$el&&this.$el.empty(),this):(this.$el&&this.$el.remove(),delete this.$el,this)},getTpl:U.emptyFn,onRender:function(){this.linkElements(),this.registerButtonHandlers(),this.setListeners()},onActionBtn:function(e){var t,i,n,s;return t=$(e.currentTarget),i=t.attr("data-action"),n=this.btnHandlers[i],s=this[i+"BtnHandler"],i&&($.isFunction(n)||$.isFunction(s))?$.isFunction(n)?n.call(this,e):(window.__DEBUG__===!0&&console.log("Unregistered button handler, please rewrite, its use is deprecated.","Handler: "+i+"BtnHandler",",action: "+i),s.call(this,e)):!!this.bubbleButtonEvent},update:U.emptyFn,setListeners:function(){this.$el.on("click",U.dom.getBtnActionSelector(""),this.onActionBtn.bind(this))},registerButtonHandlers:function(){this.doRegisterButtonHandlers(this.getButtonHandlersConfig())},doRegisterButtonHandlers:function(e){e=e||{},this.btnHandlers=e},getBtn:function(e){return U.isString(e)&&e+""!=""?this.$el.find(U.dom.getBtnActionSelector(e)):U.getEmpty$()},getButtonHandlersConfig:U.emptyFn,linkElements:U.emptyFn,onBeforeRender:U.emptyFn,onShow:U.emptyFn,onHide:U.emptyFn,onHaveSizeBeforeShow:U.emptyFn,findEl:function(e){var t='[data-uid="{0}"]'.format(this.id);return e?e.find(t):$(t)},getContainerUid:function(e){return(e||this).id+this.containerPostFix}})}),define("field/Gamefield.Face",["field/face/face.control.main","abstract/AbstractAngularComponent"],function(e){var t="Gamefield.Face";return U.define({className:t,"extends":"AbstractAngularComponent",moduleName:"GamefieldModule",controllerName:"GameFieldController",cellCls:"cell",cellNgCls:"ng-binding ng-scope",__fieldResizeTimeout:"",getTpl:function(){return'<table><tbody><tr ng-repeat="row in rows"><td ng-repeat="cell in row.cells" class="c{{cell.index}} r{{row.index}} [% cellNgCls %] [% cellCls %] value{{cell.displayValue}}"><div class="outer-content-simple"><div class="coords">{{cell.cell}}:{{cell.row}}</div><div class="inner {{cell.valueCls}}">{{cell.displayValue || "&nbsp;"}}</div></div></td></tr></tbody></table>'},initComponent:function(t,i){t.call(this,i),this.module=angular.module(this.moduleName,[]),this.module.controller(this.controllerName,["$scope",e])},update:function(e,t){var i=this.getScope();i.rows=e?e:i.rows,i.cells=t?t:i.cells,i.$apply()},getScope:function(){var e;try{e=$(this.main.gfSelector).scope()}catch(t){e=window.gfScope}return e},onRender:function(e){e.call(this),this.resize()},setListeners:function(e){e.call(this),this.main.on("resize",this.scheduleResizeField.bind(this,1)),!this.__resizeListenerSet&&$(window).on("resize",this.scheduleResizeField.bind(this)),this.__resizeListenerSet=!0},linkElements:function(e){e.call(this),this.$gf=$(this.renderToSelector)},$getCell:function(e,t){var i=$("td"+U.c2s(this.cellCls)+U.c2s(this.cellNgCls)+".c{0}.r{1}".format(e||0,t||0));return i.get(0)?i:!1},scheduleResizeField:function(e,t,i){this.__fieldResizeTimeout&&clearTimeout(this.__fieldResizeTimeout),this.__fieldResizeTimeout=setTimeout(this.resize.bind(this),100)},resize:function(){var e,t,i;clearTimeout(this.__fieldResizeTimeout),e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=t>=e?parseInt(1*e,10):parseInt(.7*t,10),this.$gf.width(i),this.$gf.height(i),this.updateFontSize()},updateFontSize:function(){var e=this.$el.find("td").first().outerHeight();this.$el.css({fontSize:parseInt(e/2.5,10)})}}),U.ClassManager.get(t).prototype}),define("field/Gamefield",["field/Gamefield.Brains","field/Gamefield.Face"],function(e,t){var i="Gamefield";return U.define({className:i,gfSelector:"#gamefield",defaultSize:4,initComponent:function(e){this.linkElements(),this.$gf.hide(),U.apply(this,e),this.createItems(),this.setListeners()},createItems:function(){this.brains=U.cc({className:e.className,main:this}),this.face=U.cc({className:t.className,renderToSelector:this.gfSelector,main:this})},setListeners:function(){var e=$("body").get(0),t=new Hammer(e);t.get("swipe").set({direction:Hammer.DIRECTION_ALL,treshold:25,velocity:.1}),t.get("pan").set({direction:Hammer.DIRECTION_VERTICAL,treshold:150}),$(document).on("keydown",this.onKeyDown.bind(this)),t.on("swipeleft swiperight swipeup swipedown",this.onSwipe.bind(this))},linkElements:function(){this.$eventEl=$("<div>"),this.$gf=this.$gamefield=$(this.gfSelector)},init:function(){this.setSize(this.defaultSize)},updateFace:function(){this.face.update(this.rows,this.cells)},_add:function(e){if(e-=1,0>e)return this;this.rows=this.rows||[],this.cells=this.cells||[];var t,i,n,s,r;r=this.rows.length,s=this.rows[0]&&this.rows[0].cells&&this.rows[0].cells.length||0,n=0;for(var o;r+e>=n;){for(i=0,t=r>n&&this.rows[n]?this.rows[n]:{index:n,cells:[]};s+e>=i;)t.cells[i]||(o={index:i,row:n,cell:i,value:0},t.cells.push(o)),i++;this.rows[n]||this.rows.push(t),n++}for(i=0;i<this.rows[0].cells.length;){for(n=0,this.cells.push({index:i,rows:[]});n<this.rows.length;)this.cells[i].rows=this.cells[i].rows||[],this.cells[i].rows.push(this.rows[n].cells[i]),n++;i++}return this},addSize:function(e){this._add(e).updateFace(),this.gameWidth=this.rows[0].cells.length,this.gameHeight=this.rows.length,this.onFieldSizeChange()},setSize:function(e,t){return this.rows=[],e!==t&&U.isDefined(t)?console.error("Not yet implemented non-square"):(t=e,this._add(e)),this.gameWidth=e,this.gameHeight=t,this.updateFace(),this.onFieldSizeChange(),this},moveX:function(e){var t,i,n,s,r,o,l,a,h,c;s=this.gameHeight,r=this.gameWidth,o=this.gameWidth;var d,u,f,m,g,p,v,w;for(d=[],p=!1,n=0,a=-1===e?0:o-1,l=function(t){return-1===e?o>t:t>=0},h=function(t){return-1===e?t>=0:o>t},console.clear();s>n;n++){i=-1===e?0:o-1;e:for(;l(i);i+=-1*e)if(t=this.rows[n].cells[i],t.value&&i!==a)for(c={x:t.cell,y:t.row},w=null,v=0,u=i;h(u);u+=e)if(t=this.rows[n].cells[u],f=this.rows[n].cells[u+e])if(g=f&&!f.value)this.setCellAsValue(f,f.value+t.value),this.setCellAsFree(t),v++,p=!0,w={x:f.cell,y:f.row},console.log("move FREE",f.cell+":"+f.row,f.value);else{if(f.value===t.value){this.setCellAsValue(f,f.value+t.value),this.setCellAsFree(t),v++,p=!0,console.log("move NOT FREE",f.cell+":"+f.row,f.value),w={x:f.cell,y:f.row},v>0&&(console.log("move is over",c,w),d.push({from:c,to:w}));continue e}m=u}else v>0&&(console.log("move is over",c,w||t),d.push({from:c,to:w||t}))}this.animateMoves(d,"x",p)},moveY:function(e){var t,i,n,s,r,o,l,a,h,c;s=this.gameHeight,r=this.gameWidth,o=this.gameWidth;var d,u,f,m,g,p,v,w;for(d=[],p=!1,i=0,a=-1===e?0:s-1,l=function(t){return-1===e?s>t:t>=0},h=function(t){return-1===e?t>=0:s>t},console.clear();r>i;i++){n=-1===e?0:s-1;e:for(;l(n);n+=-1*e)if(t=this.rows[n].cells[i],t.value&&n!==a)for(c={x:t.cell,y:t.row},w=null,v=0,u=n;h(u);u+=e)if(t=this.rows[u].cells[i],f=this.rows[u+e]&&this.rows[u+e].cells[i])if(g=f&&!f.value)this.setCellAsValue(f,f.value+t.value),this.setCellAsFree(t),v++,p=!0,w={x:f.cell,y:f.row},console.log("move FREE",f.cell+":"+f.row,f.value);else{if(f.value===t.value){this.setCellAsValue(f,f.value+t.value),this.setCellAsFree(t),v++,p=!0,console.log("move NOT FREE",f.cell+":"+f.row,f.value),w={x:f.cell,y:f.row},v>0&&(console.log("move is over",c,w),d.push({from:c,to:w}));continue e}m=u}else v>0&&(console.log("move is over",c,w||t),d.push({from:c,to:w||t}))}this.animateMoves(d,"y",p)},animateMoves:function(e,t,i){e.forEach(function(e){var i,n,s,r,o,l;i=$(".c"+e.from.x+".r"+e.from.y),n=$(".c"+e.to.x+".r"+e.to.y),console.log(i,n),s=i.position(),r=n.position(),i.addClass("animating"),o="translate"+t.toUpperCase()+"(%amount%px)",l="x"===t?r.left-s.left:r.top-s.top,i.css({transform:o.replace("%amount%",l)})}),setTimeout(this._afterMove.bind(this,i),50)},_afterMove:function(e){$("td").removeClass("animating").css("transform",""),e&&this.addGameNumber(),this.updateFace()},addGameNumber:function(e,t){var i,n=this.brains.createNumber();return(i=U.areDefined(e,t)?this.rows[t].cells[e]:this.brains.findFreePos(this.rows))?(this.setCellAsValue(i,n.value),void this.updateFace()):(console.warn("it's over"),void this.setSize(4,4))},setCellAsValue:function(e,t){e.value=t,e.displayValue=t,e.valueCls="game-number"},setCellAsFree:function(e){e.value=0,e.displayValue=null,e.valueCls="free"},fire:function(e){this.$eventEl.trigger(e)},on:function(e,t,i,n){var s=i?Function.bind.apply(t,[i].concat(n)):t;this.$eventEl.on(e,s)},onAngularReady:function(){angular.bootstrap(document,[this.face.moduleName]),this.init(),this.$gf.fadeIn(300),this.fire("resize"),this.fire("fieldready")},prepareAngular:function(){angular.element(document).ready(this.onAngularReady.bind(this))},onFieldSizeChange:function(){this.fire("resize")},onKeyDown:function(e){var t=!1;switch(e.which){case 37:return this.moveX(-1),t=!0,!1;case 39:return this.moveX(1),t=!0,!1;case 38:return this.moveY(-1),t=!0,!1;case 40:return this.moveY(1),t=!0,!1}t&&(e.stopPropagation(),e.preventDefault())},onSwipe:function(e){switch(e.preventDefault(),e.type){case"swipeleft":case"panleft":return this.moveX(-1),!1;case"swiperight":case"panright":return this.moveX(1),!1;case"swipeup":case"panup":return this.moveY(-1),!1;case"swipedown":case"pandown":return this.moveY(1),!1}return!1}}),U.ClassManager.get(i).prototype}),define("Game",["field/Gamefield"],function(e){function t(){window.Game.field.addGameNumber()}var i;i=$(e.gfSelector);var n=this;this.gf=this.gamefield=this.field=U.cc({className:e.className,game:this}),this.gf.$eventEl.on("fieldready",t.bind(this)),window.g=window.game=window.Game=this,window.gf=this.gf,n.field.prepareAngular()}),require(["Game"]),define("o",function(){});